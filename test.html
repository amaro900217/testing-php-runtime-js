<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>PHP WASM LOCAL API Tests</title>
        <style>
            :root {
                --background: hsl(210, 20%, 98%);
                --foreground: hsl(210, 10%, 20%);
                --card: hsl(0, 0%, 100%);
                --card-foreground: hsl(210, 10%, 20%);
                --primary: hsl(210, 70%, 45%);
                --primary-foreground: hsl(0, 0%, 100%);
                --secondary: hsl(210, 20%, 92%);
                --secondary-foreground: hsl(210, 10%, 20%);
                --muted: hsl(210, 20%, 92%);
                --muted-foreground: hsl(210, 10%, 45%);
                --border: hsl(210, 15%, 85%);
                --input: hsl(210, 15%, 85%);
                --ring: hsl(210, 70%, 45%);
                --destructive: hsl(0, 80%, 55%);
                --destructive-foreground: hsl(0, 0%, 100%);
                --radius: 12px;
                --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            }
            @media (prefers-color-scheme: dark) {
                :root {
                    --background: hsl(220, 15%, 8%);
                    --foreground: hsl(210, 20%, 90%);
                    --card: hsl(220, 15%, 12%);
                    --card-foreground: hsl(210, 20%, 90%);
                    --primary: hsl(210, 70%, 65%);
                    --primary-foreground: hsl(220, 15%, 8%);
                    --secondary: hsl(220, 15%, 20%);
                    --secondary-foreground: hsl(210, 20%, 90%);
                    --muted: hsl(220, 15%, 20%);
                    --muted-foreground: hsl(210, 10%, 70%);
                    --border: hsl(220, 15%, 25%);
                    --input: hsl(220, 15%, 25%);
                    --ring: hsl(210, 70%, 65%);
                    --destructive: hsl(0, 80%, 65%);
                    --destructive-foreground: hsl(220, 15%, 8%);
                    --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                }
            }
            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }
            body {
                margin: 0;
                font-family:
                    "Google Sans",
                    "Inter",
                    -apple-system,
                    BlinkMacSystemFont,
                    "Segoe UI",
                    Roboto,
                    "Helvetica Neue",
                    Arial,
                    sans-serif;
                background-color: var(--background);
                color: var(--foreground);
                min-height: 100vh;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                -webkit-font-smoothing: antialiased;
                padding: 1.5rem 1rem;
                transition:
                    background-color 0.3s,
                    color 0.3s;
                line-height: 1.5;
            }

            .container {
                width: 100%;
                max-width: 640px;
                margin: 0 auto;
                display: flex;
                flex-direction: column;
                gap: 1.75rem;
            }
            .card {
                background-color: var(--card);
                border: 1px solid var(--border);
                border-radius: var(--radius);
                padding: 2.5rem 1.75rem;
                box-shadow: var(--shadow);
                transition:
                    box-shadow 0.3s,
                    background-color 0.3s,
                    border-color 0.3s;
            }
            h1,
            h3 {
                margin: 0;
                font-weight: 600;
                line-height: 1.2;
            }
            h1 {
                font-size: 2rem;
                text-align: center;
                margin-bottom: 2rem;
                color: var(--primary);
                letter-spacing: -0.04em;
            }
            h3 {
                font-size: 1.35rem;
                font-weight: 500;
                margin-bottom: 1.25rem;
                color: var(--foreground);
            }
            .timer {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                padding: 2rem 1rem;
                margin-bottom: 2rem;
                border-radius: var(--radius);
                background-color: var(--muted);
                width: 100%;
                text-align: center;
            }
            .timer-value {
                font-size: 2.8rem;
                font-weight: 700;
                color: var(--primary);
                letter-spacing: -1.5px;
            }
            .timer-status {
                font-size: 1rem;
                margin-top: 0.75rem;
                color: var(--muted-foreground);
            }
            .buttons {
                display: flex;
                flex-direction: column;
                gap: 1.25rem;
            }
            button {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                font-weight: 500;
                border-radius: 9999px;
                padding: 0 1.75rem;
                height: 3.25rem;
                cursor: pointer;
                border: none;
                background-color: var(--secondary);
                color: var(--secondary-foreground);
                outline: none;
                border-radius: 9999px;
                outline: none;
                -webkit-tap-highlight-color: transparent;
            }
            button:hover {
                background-color: var(--primary);
                color: var(--primary-foreground);
                border-radius: 9999px;
            }
            button:active {
                transform: translateY(0);
                border-radius: 9999px;
                background-color: var(--primary);
                color: var(--primary-foreground);
            }
            button:focus-visible {
                outline: 2px solid var(--primary);
                outline-offset: 2px;
                border-radius: 9999px;
            }
            button svg {
                margin-right: 0.85rem;
                width: 1.35rem;
                height: 1.35rem;
                stroke-width: 2;
                opacity: 0.9;
            }
            pre#output {
                font-family:
                    "Roboto Mono", "Fira Mono", "Menlo", "Consolas", monospace;
                font-size: 0.95rem;
                overflow: auto;
                max-height: 28rem;
                background-color: var(--muted);
                color: var(--muted-foreground);
                padding: 1.5rem;
                border-radius: var(--radius);
                white-space: pre-wrap;
                word-wrap: break-word;
                line-height: 1.6;
            }
            @media (min-width: 768px) {
                body {
                    padding: 3rem;
                }
                .container {
                    gap: 2.5rem;
                }
                .card {
                    padding: 3.5rem 2.5rem;
                }
                h1 {
                    font-size: 2.8rem;
                    margin-bottom: 2.5rem;
                }
                h3 {
                    font-size: 1.5rem;
                }
                .timer {
                    padding: 2.5rem 1.5rem;
                    margin-bottom: 2.5rem;
                }
                .timer-value {
                    font-size: 3.2rem;
                }
                .buttons {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 1.75rem;
                }
                button {
                    height: 3.5rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="card">
                <h1>
                    PHP WASM <br />
                    Local API Tests
                </h1>
                <div class="timer">
                    <div id="timerValue" class="timer-value">0 ms</div>
                    <div id="timerStatus" class="timer-status">
                        Inicializando...
                    </div>
                </div>
                <div class="buttons">
                    <button id="btnRefresh">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"
                            ></path>
                            <path d="M21 3v5h-5"></path>
                            <path
                                d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"
                            ></path>
                            <path d="M8 16H3v5"></path>
                        </svg>
                        Refrescar Página
                    </button>
                    <button id="btnGetPosts">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                            ></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        Run GET /api/posts
                    </button>
                    <button id="btnInline">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <polyline points="16 18 22 12 16 6"></polyline>
                            <polyline points="8 6 2 12 8 18"></polyline>
                        </svg>
                        Run Inline PHP
                    </button>
                    <button id="btnGet1">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"
                            ></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        Run GET /script_1.php
                    </button>
                    <button id="btnGet2">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        Run GET /server_info.php
                    </button>
                    <button id="btnPost">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"
                            ></path>
                        </svg>
                        Run POST /process.php
                    </button>
                </div>
            </div>
            <div class="card">
                <h3>Output</h3>
                <pre id="output">Inicializando PHP Runtime...</pre>
            </div>
        </div>
        <script>
            window.pageStartTime = performance.now();
            window.timerInterval = null;
            // Función para actualizar el timer
            function updateTimer() {
                const elapsed = performance.now() - window.pageStartTime;
                document.getElementById("timerValue").textContent =
                    `${Math.round(elapsed)} ms`;
            }
            // Iniciar el timer
            window.timerInterval = setInterval(updateTimer, 50);
            // Función para finalizar el timer
            function stopTimer(message) {
                clearInterval(window.timerInterval);
                document.getElementById("timerStatus").textContent = message;
            }
        </script>

        <!-- Librería -->
        <script src="php-runtime.js" type="module"></script>
        <script type="module">
            const outputEl = document.getElementById("output");
            function logOutput(label, text) {
                console.log(label, text);
                outputEl.textContent += `\n=== ${label} ===\n${text}\n`;
                // Auto-scroll to bottom
                outputEl.scrollTop = outputEl.scrollHeight;
            }
            try {
                // Actualizar estado
                document.getElementById("timerStatus").textContent =
                    "Configurando PHP Runtime...";
                // Configurar PHP Runtime
                await runPHP.init({
                    DEBUG: true,
                    NUM_WORKERS: 1,
                    TIMEOUT_WORKER: 60000,
                    DOCUMENT_ROOT: "/www",
                    ENTRY_POINT: "/www/public/index.php", // ""
                    SERVER_ADDR: "127.0.0.1",
                    SERVER_NAME: "browser-localhost",
                    SERVER_SOFTWARE: "wasm-server-0.0.8",
                    SERVER_PORT: "8080",
                });
                document.getElementById("timerStatus").textContent =
                    "Ejecutando petición GET automática...";
                logOutput(
                    "INIT",
                    "PHP Runtime inicializado correctamente en " +
                        Math.round(performance.now() - window.pageStartTime) +
                        " ms",
                );
                // Ejecutar petición GET automática al cargar
                const autoResult = await runPHP.request({
                    method: "GET",
                    query: "/api/posts", // "/www/php/script_1.php",
                    payload: "",
                    headers: "",
                });
                logOutput("AUTO GET LARAVEL /api/posts", autoResult);
                // Finalizar timer
                const totalTime = Math.round(
                    performance.now() - window.pageStartTime,
                );
                stopTimer(`¡Completado! Total: ${totalTime} ms`);
            } catch (error) {
                logOutput(
                    "ERROR",
                    `Error durante la inicialización: ${error.message}`,
                );
                stopTimer(`Error: ${error.message}`);
            }
        </script>
        <script>
            document.getElementById("btnGetPosts").onclick = async () => {
                const start = performance.now();
                try {
                    const result = await runPHP.request({
                        method: "GET",
                        query: "/api/posts",
                        payload: "",
                        headers: "",
                    });
                    const time = Math.round(performance.now() - start);
                    logOutput(`GET /api/posts (${time}ms)`, result);
                    // Mostrar alert con tiempo y contenido
                    alert(
                        `GET /api/posts completado en ${time} ms\n\nRespuesta:\n${result}`,
                    );
                } catch (error) {
                    logOutput("ERROR GET /api/posts", error.message);
                    alert(`ERROR GET /api/posts:\n${error.message}`);
                }
            };
        </script>

        <script>
            const outputEl = document.getElementById("output");
            function logOutput(label, text) {
                console.log(label, text);
                outputEl.textContent += `\n=== ${label} ===\n${text}\n`;
                // Auto-scroll to bottom
                outputEl.scrollTop = outputEl.scrollHeight;
            }
            document.getElementById("btnRefresh").onclick = () => {
                location.reload();
            };
            document.getElementById("btnInline").onclick = async () => {
                const start = performance.now();
                try {
                    const result = await runPHP.inline(
                        '<?php echo "Hola desde Inline PHP - " . date("Y-m-d H:i:s"); ?>',
                    );
                    const time = Math.round(performance.now() - start);
                    logOutput(`Inline PHP (${time}ms)`, result);
                } catch (error) {
                    logOutput("ERROR Inline", error.message);
                }
            };
            document.getElementById("btnGet1").onclick = async () => {
                const start = performance.now();
                try {
                    const result = await runPHP.request({
                        method: "GET",
                        query: "/www/php/script_1.php",
                        payload: "",
                        headers: "",
                    });
                    const time = Math.round(performance.now() - start);
                    logOutput(`GET /script_1.php (${time}ms)`, result);
                } catch (error) {
                    logOutput("ERROR GET1", error.message);
                }
            };
            document.getElementById("btnGet2").onclick = async () => {
                const start = performance.now();
                try {
                    const result = await runPHP.request({
                        method: "GET",
                        query: "/www/php/server_info.php",
                        payload: "",
                        headers: "",
                    });
                    const time = Math.round(performance.now() - start);
                    logOutput(`GET /server_info.php (${time}ms)`, result);
                } catch (error) {
                    logOutput("ERROR GET2", error.message);
                }
            };
            document.getElementById("btnPost").onclick = async () => {
                const start = performance.now();
                try {
                    const result = await runPHP.request({
                        method: "POST",
                        query: "/www/php/process.php",
                        payload: "x=42&y=99",
                        headers:
                            "Content-Type: application/x-www-form-urlencoded",
                    });
                    const time = Math.round(performance.now() - start);
                    logOutput(`POST /process.php (${time}ms)`, result);
                } catch (error) {
                    logOutput("ERROR POST", error.message);
                }
            };
        </script>
    </body>
</html>

